# 기능 명세서 (Functional Specification)

**프로젝트명**: CollaBoard  
**버전**: 1.0.0  
**작성일**: 2025-11-13

---

## 1. 사용자 스토리 (User Stories)

### Epic 1: 보드 관리

#### US-1.1: 보드 생성
**As a** 팀 리더  
**I want to** 새로운 프로젝트 보드를 생성하고 싶다  
**So that** 팀원들과 작업을 구조화할 수 있다

**인수 기준 (Acceptance Criteria)**
- [ ] "새 보드 만들기" 버튼을 클릭하면 모달이 열린다
- [ ] 보드 제목을 입력할 수 있다 (1-100자)
- [ ] 6가지 배경색 프리셋 중 선택할 수 있다
- [ ] "만들기" 버튼 클릭 시 보드가 생성되고 해당 보드 페이지로 이동한다
- [ ] 제목이 비어있으면 "만들기" 버튼이 비활성화된다
- [ ] 생성 실패 시 에러 메시지가 표시된다

**기술 노트**
- 낙관적 업데이트 적용
- 생성 즉시 로컬 상태 업데이트 후 서버 요청
- WebSocket으로 다른 사용자에게 브로드캐스트

#### US-1.2: 보드 목록 조회
**As a** 사용자  
**I want to** 내가 생성하거나 참여한 보드 목록을 보고 싶다  
**So that** 원하는 보드에 빠르게 접근할 수 있다

**인수 기준**
- [ ] 대시보드에 보드 목록이 그리드 형태로 표시된다
- [ ] 각 보드 카드에는 제목, 배경색, 최종 수정 시간이 표시된다
- [ ] 최신 수정 순으로 정렬된다
- [ ] 최근 7일 이내 접속한 보드는 "최근 접속" 뱃지가 표시된다
- [ ] 보드 카드 클릭 시 해당 보드 페이지로 이동한다
- [ ] 로딩 중에는 스켈레톤 UI를 표시한다

**기술 노트**
- TanStack Query로 캐싱 (staleTime: 5분)
- Intersection Observer로 무한 스크롤 (20개씩 로딩)

---

### Epic 2: 리스트 관리

#### US-2.1: 리스트 생성
**As a** 프로젝트 관리자  
**I want to** 보드에 새로운 리스트를 추가하고 싶다  
**So that** 작업 단계를 정의할 수 있다

**인수 기준**
- [ ] 보드 맨 오른쪽에 "+ 리스트 추가" 버튼이 있다
- [ ] 클릭하면 인라인 입력 폼이 나타난다
- [ ] 리스트 제목을 입력할 수 있다 (1-50자)
- [ ] Enter 키 또는 "추가" 버튼으로 생성한다
- [ ] ESC 키 또는 포커스 아웃으로 취소한다
- [ ] 생성 후 자동으로 다음 리스트 생성 모드로 진입한다
- [ ] 실시간으로 다른 사용자에게 표시된다

**기술 노트**
- 낙관적 업데이트
- Zustand로 로컬 상태 즉시 반영
- WebSocket 이벤트: `list:created`

#### US-2.2: 리스트 순서 변경
**As a** 사용자  
**I want to** 리스트의 순서를 변경하고 싶다  
**So that** 워크플로우에 맞게 정렬할 수 있다

**인수 기준**
- [ ] 리스트 헤더를 드래그하여 수평 이동할 수 있다
- [ ] 드래그 중 플레이스홀더가 표시된다
- [ ] 드롭 시 애니메이션과 함께 위치가 변경된다
- [ ] Alt + ← / → 키로도 이동할 수 있다 (접근성)
- [ ] 이동 중에도 60fps를 유지한다
- [ ] 실시간으로 다른 사용자에게 반영된다

**기술 노트**
- @dnd-kit 사용
- `useSensors`로 마우스/키보드 센서 설정
- `DndContext` + `SortableContext` 구조
- 순서 변경 시 `position` 필드 재계산 (LexoRank 알고리즘 검토)

---

### Epic 3: 카드 관리

#### US-3.1: 카드 생성
**As a** 팀원  
**I want to** 리스트에 작업 카드를 추가하고 싶다  
**So that** 할 일을 기록할 수 있다

**인수 기준**
- [ ] 리스트 맨 아래에 "+ 카드 추가" 버튼이 있다
- [ ] 클릭하면 인라인 입력 폼이 나타난다
- [ ] 카드 제목을 입력할 수 있다 (1-200자)
- [ ] Enter 키로 생성하고 다음 카드 입력 모드로 진입한다
- [ ] Shift + Enter로 생성하고 입력 모드 종료한다
- [ ] ESC 키로 취소한다
- [ ] 실시간으로 다른 사용자에게 표시된다

**기술 노트**
- Textarea 자동 높이 조절 (`autosize` 라이브러리)
- 낙관적 업데이트 + 롤백 처리

#### US-3.2: 카드 이동
**As a** 사용자  
**I want to** 카드를 다른 리스트나 다른 위치로 이동하고 싶다  
**So that** 작업 진행 상황을 업데이트할 수 있다

**인수 기준**
- [ ] 카드를 드래그하여 리스트 내/리스트 간 이동할 수 있다
- [ ] 드래그 중 반투명 상태로 표시된다
- [ ] 드롭 가능한 영역에 시각적 피드백이 있다
- [ ] 드롭 시 부드러운 애니메이션과 함께 이동한다
- [ ] Alt + ↑/↓로 리스트 내 순서 변경 (접근성)
- [ ] Alt + ←/→로 이전/다음 리스트로 이동 (접근성)
- [ ] 100개 이상 카드가 있어도 끊김 없이 동작한다
- [ ] 실시간으로 다른 사용자에게 반영된다

**기술 노트**
- @dnd-kit의 `DragOverlay` 사용 (성능 최적화)
- `react-window` 가상화 검토 (100개 이상 카드)
- 이동 중 `useTransition`으로 낮은 우선순위 업데이트

#### US-3.3: 카드 상세 조회/수정
**As a** 팀원  
**I want to** 카드의 상세 정보를 보고 편집하고 싶다  
**So that** 작업에 대한 맥락을 추가할 수 있다

**인수 기준**
- [ ] 카드 클릭 시 모달이 열린다
- [ ] 제목을 인라인 편집할 수 있다
- [ ] 설명을 마크다운 에디터로 작성할 수 있다
- [ ] 라벨을 다중 선택할 수 있다 (최대 5개)
- [ ] 담당자를 단일 선택할 수 있다
- [ ] 변경사항은 자동 저장된다 (debounce 500ms)
- [ ] ESC 키 또는 외부 클릭으로 모달을 닫는다
- [ ] 변경사항이 실시간으로 다른 사용자에게 반영된다

**기술 노트**
- Radix UI Dialog 사용
- 마크다운 에디터: `@uiw/react-md-editor` 검토
- 자동 저장: `useDebouncedValue` 훅

---

### Epic 4: 실시간 협업

#### US-4.1: 실시간 동기화
**As a** 팀원  
**I want to** 다른 사용자의 변경사항을 실시간으로 보고 싶다  
**So that** 항상 최신 정보를 확인할 수 있다

**인수 기준**
- [ ] 다른 사용자가 보드/리스트/카드를 생성하면 즉시 표시된다
- [ ] 다른 사용자가 항목을 수정하면 즉시 업데이트된다
- [ ] 다른 사용자가 항목을 삭제하면 즉시 제거된다
- [ ] 다른 사용자가 드래그앤드롭하면 부드럽게 애니메이션된다
- [ ] 변경사항이 500ms 이내에 반영된다
- [ ] 네트워크 끊김 시 "연결 끊김" 알림이 표시된다
- [ ] 재연결 시 자동으로 최신 상태를 동기화한다

**기술 노트**
- Socket.io Client 사용
- 이벤트 타입:
  - `board:updated`
  - `list:created`, `list:updated`, `list:deleted`, `list:moved`
  - `card:created`, `card:updated`, `card:deleted`, `card:moved`
- 재연결 시 `board:sync` 이벤트로 전체 상태 가져오기

#### US-4.2: 현재 접속 사용자 표시
**As a** 사용자  
**I want to** 현재 누가 이 보드를 보고 있는지 알고 싶다  
**So that** 동시 작업 시 충돌을 피할 수 있다

**인수 기준**
- [ ] 우측 상단에 접속 중인 사용자 아바타가 표시된다
- [ ] 최대 5명까지 표시하고, 초과 시 "+N" 표시
- [ ] 사용자 입장/퇴장 시 애니메이션과 함께 업데이트된다
- [ ] 아바타 호버 시 사용자 이름이 툴팁으로 표시된다
- [ ] 게스트 사용자는 "Guest#1234" 형식으로 표시된다

**기술 노트**
- WebSocket 이벤트: `user:joined`, `user:left`
- Zustand store에 `activeUsers` 상태 관리
- Framer Motion의 `AnimatePresence` 사용

#### US-4.3: 충돌 방지
**As a** 개발자  
**I want to** 동시 수정 시 데이터 무결성을 보장하고 싶다  
**So that** 사용자가 예상치 못한 동작을 경험하지 않는다

**인수 기준**
- [ ] 낙관적 업데이트가 실패하면 롤백되고 에러 메시지가 표시된다
- [ ] 동일한 카드를 동시에 수정하면 마지막 저장이 우선된다 (LWW)
- [ ] 서버 에러 시 재시도 로직이 동작한다 (최대 3회)
- [ ] 버전 충돌 시 사용자에게 리프레시 권장 메시지 표시

**기술 노트**
- TanStack Query의 `onError` 콜백으로 롤백
- Optimistic Update: `useMutation`의 `onMutate` 활용
- 재시도: `retry: 3, retryDelay: (attempt) => Math.min(1000 * 2 ** attempt, 30000)`

---

### Epic 5: 인증

#### US-5.1: 이메일 로그인
**As a** 신규 사용자  
**I want to** 이메일로 회원가입하고 싶다  
**So that** 여러 기기에서 내 보드에 접근할 수 있다

**인수 기준**
- [ ] 이메일과 비밀번호를 입력할 수 있다
- [ ] 이메일 형식이 올바른지 검증한다
- [ ] 비밀번호는 8자 이상, 영문+숫자 조합을 요구한다
- [ ] 실시간 유효성 검사 피드백을 제공한다
- [ ] "회원가입" 버튼 클릭 시 계정이 생성되고 자동 로그인된다
- [ ] 이미 존재하는 이메일이면 에러 메시지를 표시한다
- [ ] 로그인 성공 시 JWT 토큰을 로컬 스토리지에 저장한다
- [ ] 로그인 후 보드 목록 페이지로 리디렉션된다

**기술 노트**
- React Hook Form + Zod 스키마 검증
- JWT 토큰 만료: 7일 (Access Token), 30일 (Refresh Token)
- 토큰 만료 시 자동 갱신 (Axios Interceptor)

#### US-5.2: 게스트 모드
**As a** 빠르게 테스트하고 싶은 사용자  
**I want to** 로그인 없이 사용하고 싶다  
**So that** 즉시 기능을 체험할 수 있다

**인수 기준**
- [ ] 랜딩 페이지에 "게스트로 시작" 버튼이 있다
- [ ] 클릭하면 임시 게스트 ID가 생성되고 보드 목록 페이지로 이동한다
- [ ] 게스트 데이터는 로컬 스토리지에 저장된다
- [ ] 상단에 "게스트 모드" 배너가 표시되고 "회원 전환" 버튼이 있다
- [ ] "회원 전환" 클릭 시 회원가입 폼이 열린다
- [ ] 회원 전환 시 기존 게스트 데이터를 서버로 마이그레이션한다
- [ ] 로컬 스토리지 클리어 시 게스트 데이터가 사라진다

**기술 노트**
- 게스트 ID: `uuid.v4()`
- LocalStorage key: `collaboard_guest_data`
- 마이그레이션 API: `POST /api/auth/migrate-guest`

---

## 2. 화면 흐름도 (Screen Flow)

```
[랜딩 페이지]
  ├─ [로그인] → [보드 목록]
  ├─ [회원가입] → [보드 목록]
  └─ [게스트로 시작] → [보드 목록]

[보드 목록]
  ├─ [새 보드 만들기] → [보드 상세]
  └─ [보드 카드 클릭] → [보드 상세]

[보드 상세]
  ├─ [리스트 추가]
  ├─ [카드 추가]
  ├─ [카드 클릭] → [카드 상세 모달]
  └─ [설정] → [보드 설정 모달]

[카드 상세 모달]
  ├─ [제목 편집]
  ├─ [설명 편집]
  ├─ [라벨 추가/제거]
  ├─ [담당자 할당]
  └─ [삭제] → [보드 상세]
```

---

## 3. UI 상태 정의

### 3.1 보드 상태
```typescript
type BoardStatus = 'idle' | 'loading' | 'error' | 'empty';

interface BoardState {
  status: BoardStatus;
  board: Board | null;
  lists: List[];
  error: Error | null;
}
```

### 3.2 드래그 상태
```typescript
interface DragState {
  activeId: string | null;
  overId: string | null;
  type: 'list' | 'card' | null;
  startListId: string | null;
}
```

### 3.3 실시간 연결 상태
```typescript
type ConnectionStatus = 'connected' | 'disconnected' | 'reconnecting';

interface RealtimeState {
  status: ConnectionStatus;
  activeUsers: User[];
  lastSyncedAt: Date | null;
}
```

---

## 4. 에러 처리

### 4.1 에러 타입 정의
```typescript
type ErrorCode = 
  | 'NETWORK_ERROR'
  | 'UNAUTHORIZED'
  | 'NOT_FOUND'
  | 'VALIDATION_ERROR'
  | 'CONFLICT'
  | 'SERVER_ERROR';

interface AppError {
  code: ErrorCode;
  message: string;
  details?: unknown;
}
```

### 4.2 에러 메시지 매핑
| ErrorCode | 사용자 메시지 | 액션 |
|-----------|-------------|------|
| NETWORK_ERROR | "네트워크 연결을 확인해주세요." | 재시도 버튼 표시 |
| UNAUTHORIZED | "로그인이 필요합니다." | 로그인 페이지로 리디렉션 |
| NOT_FOUND | "요청한 리소스를 찾을 수 없습니다." | 이전 페이지로 이동 |
| VALIDATION_ERROR | 서버에서 받은 메시지 표시 | 입력 필드 하이라이트 |
| CONFLICT | "다른 사용자가 수정했습니다. 새로고침해주세요." | 새로고침 버튼 |
| SERVER_ERROR | "일시적인 오류가 발생했습니다." | 재시도 버튼 |

### 4.3 에러 바운더리
- 컴포넌트 레벨 에러 바운더리 (각 주요 기능)
- 전역 에러 바운더리 (루트 레벨)
- Sentry로 에러 로깅

---

## 5. 로딩 상태

### 5.1 스켈레톤 UI
- **보드 목록**: 그리드 형태 스켈레톤 (6개)
- **보드 상세**: 리스트 스켈레톤 (3개), 각 리스트당 카드 스켈레톤 (5개)
- **카드 상세**: 제목/설명/라벨 영역 스켈레톤

### 5.2 낙관적 업데이트
- 즉시 UI 업데이트
- 백그라운드에서 서버 요청
- 실패 시 롤백 + 에러 토스트

### 5.3 서스펜스 경계
- Route 레벨 Suspense (페이지 전환)
- 컴포넌트 레벨 Suspense (모달, 드로어)

---

## 6. 접근성 (Accessibility)

### 6.1 키보드 네비게이션
| 키 조합 | 동작 |
|--------|------|
| Tab / Shift+Tab | 포커스 이동 (순방향/역방향) |
| Enter | 현재 포커스 항목 열기/실행 |
| Space | 체크박스 토글, 드롭다운 열기 |
| Esc | 모달/드로어 닫기, 편집 모드 취소 |
| Alt + ↑/↓ | 카드 위/아래 이동 |
| Alt + ←/→ | 리스트 이전/다음 이동, 카드 리스트 간 이동 |
| / | 검색 포커스 (2순위 기능) |
| Ctrl/Cmd + K | 커맨드 팔레트 (2순위 기능) |

### 6.2 ARIA 속성
- `role="button"`, `role="dialog"`, `role="listbox"` 등 적절한 역할 명시
- `aria-label`, `aria-labelledby` 로 레이블 제공
- `aria-live="polite"` 로 실시간 업데이트 알림
- `aria-describedby` 로 추가 설명 제공

### 6.3 포커스 관리
- 모달 열릴 때 첫 번째 입력 필드로 포커스
- 모달 닫힐 때 이전 포커스 위치로 복원
- 드래그 중에도 키보드 포커스 유지

---

## 7. 성능 최적화

### 7.1 렌더링 최적화
- `React.memo` 적용 (카드, 리스트 컴포넌트)
- `useMemo`, `useCallback` 적극 활용
- 가상화 (`react-window`) 검토 (100+ 카드)

### 7.2 번들 최적화
- Code Splitting (Route 기반)
- Dynamic Import (모달, 에디터 등)
- Tree Shaking 확인
- 번들 사이즈 모니터링 (`bundlephobia`)

### 7.3 네트워크 최적화
- TanStack Query 캐싱 전략
  - `staleTime`: 5분 (보드 목록)
  - `staleTime`: 1분 (보드 상세)
  - `cacheTime`: 30분
- 이미지 최적화 (WebP, 지연 로딩)
- HTTP/2 서버 푸시 검토

---

## 8. 테스트 시나리오

### 8.1 E2E 테스트 (Playwright)
1. **신규 사용자 온보딩**
   - 회원가입 → 보드 생성 → 리스트 추가 → 카드 추가
2. **드래그앤드롭 워크플로우**
   - 카드 리스트 내 이동 → 리스트 간 이동 → 리스트 순서 변경
3. **실시간 협업**
   - 2개 브라우저 창 동시 실행 → 한쪽에서 카드 생성 → 다른 쪽에서 즉시 보이는지 확인
4. **충돌 처리**
   - 네트워크 끊기 → 카드 생성 시도 → 재연결 후 동기화 확인

### 8.2 유닛 테스트 (Vitest)
- **Zustand Store 테스트**: 액션 디스패치 시 상태 변경 검증
- **Hook 테스트**: 커스텀 훅의 반환값 및 사이드 이펙트 검증
- **유틸리티 함수 테스트**: 순서 계산, 날짜 포맷 등

### 8.3 컴포넌트 테스트 (Testing Library)
- **버튼 클릭**: 올바른 이벤트 핸들러 호출 확인
- **폼 제출**: 유효성 검사 및 제출 로직 검증
- **조건부 렌더링**: props에 따른 UI 변화 확인

---

## 9. 참조
- [요구사항 명세서](./REQUIREMENTS.md)
- [API 명세서](./API_SPEC.md)
- [데이터베이스 스키마](./DATABASE_SCHEMA.md)

